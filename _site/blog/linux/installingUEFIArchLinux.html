<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Installing UEFI Arch Linux</title>
    <meta name="description" content="I have done this twice now. The first time took three days. The second time took about an hour. I figured I would share what I have learned.">

    
    <meta name="keywords" content="" />
    

    <meta name="HandheldFriendly" content="True">
    <meta name="robots" content="index,follow">
    <meta name="googlebot" content="index,follow">

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
    <link rel="stylesheet" href="../../css/style.css">

    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>

</head>

<body class="home-template">
<div class="site-wrapper">
    <header class="main-header detail-page text-center">
<h1 style="font-size: 5em" class="page-title text-center"><a style="color: black; text-decoration: none" href="/blog" title="things">things</a></h1>
<h4 class="page-description">I have never known what to call my blog. It has things in it though, so I went with that.</h4>
</header>
    <main class="content text-center" role="main">
    <article class="post single-post" itemscope itemtype="http://schema.org/BlogPosting">

        <header class="post-header short-diver row">
            <h1 class="post-title" itemprop="name headline">Installing UEFI Arch Linux</h1>
            <section class="post-meta">
                <time datetime="2016-07-07T00:00:00-04:00" itemprop="datePublished">Jul 7, 2016</time>
                on
                
            </section>
        </header>

        <section class="post-content short-diver row" itemprop="articleBody">
            <div class=" col-md-6 col-md-offset-3 text-left">
                <p>I have done this twice now. The first time took three days. The second time took about an hour. I figured I would share what I have learned.</p>

<p>This will only walk you through getting Arch Linux set up on a UEFI machine. It will not take you through creating custom users or installing a GUI. There are plenty of good Arch Linux guides for that. I am writing this because all the resources I have found on the subject have been lackluster. The only solid resource is the Arch Linux beginners guide and it can be hard to follow when you are unexperienced with Arch.</p>

<h3 id="tldr">TL;DR</h3>
<p>Here are the steps we are going to walk through in detail.</p>

<ol>
  <li>Make sure you have booted in UEFI mode.</li>
  <li>Connect to the internet</li>
  <li>Prepare your hard drive/s
    <ol>
      <li>Identify the device/s</li>
      <li>Partition the device/s</li>
      <li>Format the device/s</li>
      <li>Install UEFI software</li>
      <li>Mount the device/s</li>
    </ol>
  </li>
  <li>Install Arch on your hard drive/s
    <ol>
      <li>Select your mirror</li>
      <li>Pacstrap</li>
    </ol>
  </li>
  <li>Configure your install
    <ol>
      <li>Generate fstab</li>
      <li>Change root into install</li>
      <li>Generate locales</li>
      <li>Set time</li>
      <li>Configure the network</li>
      <li>Set root password</li>
    </ol>
  </li>
  <li>Unmount and reboot</li>
</ol>

<h3 id="detailed-steps">Detailed Steps</h3>

<ol>
  <li>
    <p>Make sure you have booted in UEFI mode.</p>

    <ul>
      <li>In order to do a proper UEFI install, you have to be booted in UEFI mode. To check type the following shell command.
<code class="highlighter-rouge">ls /sys/firmware/efi/efivars</code>
This should return a fairly large list. If it doesn’t, something is wrong. Check out your bios to make sure you are booting to UEFI mode. Most computers have an option to enable legacy BIOS boot. You will need to have that turned off.</li>
    </ul>
  </li>
  <li>
    <p>Connect to the internet</p>

    <ul>
      <li>
        <p>There are two main ways to do this: wired or wireless.</p>

        <ul>
          <li>
            <h5 id="wired">Wired</h5>
            <ul>
              <li>I just run <code class="highlighter-rouge">dhcpcd</code>.</li>
            </ul>
          </li>
          <li>
            <h5 id="wireless">Wireless</h5>
            <ul>
              <li>I evenutally configure this to use auto-netctl, but wifi-menu is fine for now. <code class="highlighter-rouge">wifi-menu</code></li>
            </ul>
          </li>
        </ul>
      </li>
    </ul>
  </li>
  <li>Prepare your hard drive/s
    <ol>
      <li>Identify the device/s
Run <code class="highlighter-rouge">lsblk</code> to identify the devices on your machine. They should be named sda, sdb, sdc, etc… You should know the approximate size of the drive you will be installing to, so identify the drive with around that amount of storage.</li>
      <li>
        <p>Partition the device/s</p>

        <ol>
          <li>Start gdisk on the drive you will install to. <code class="highlighter-rouge">gdisk /dev/sdX</code> X is the letter identifier of the drive you will install to. It will start and wait for you to give it a command.</li>
          <li>Type <code class="highlighter-rouge">o</code> and hit enter. It will tell you that you are wiping the disk. Tell it to go for it.</li>
          <li>Type <code class="highlighter-rouge">n</code> to create a new partition. The first partition we are creating will be the UEFI System partition. Hit enter to accept the label of 1, then hit enter again to accept the starting memory point. It will ask you for an end memory point. Type <code class="highlighter-rouge">+512M</code>. This will create a partition that is 512MiB in size. Finally, it will ask for the filesystem type. The code for UEFI System partition is <code class="highlighter-rouge">ee00</code>. You can verify this by viewing the list of all partition types. To view the list type <code class="highlighter-rouge">L</code> and hit enter.</li>
          <li>Type <code class="highlighter-rouge">n</code> to create a new partition. The second partition will be swap. Accept the label of 2 and the starting memory point, then chose how big of a swap you want. I would reccommend either <code class="highlighter-rouge">+2G</code> or <code class="highlighter-rouge">+4G</code>. The code for a linux swap partition is <code class="highlighter-rouge">8200</code>.</li>
          <li>Type <code class="highlighter-rouge">n</code> to create a new partition. The third and final partition will be the root filesystem. Accept the label of 3, the starting memory point, and the default ending memory point. It will default to using the rest of the disk. Then hit enter to accept the default <code class="highlighter-rouge">8300</code> partition code for Linux Filesystem.</li>
          <li>You need to write all these changes to the disk. Type <code class="highlighter-rouge">w</code>, and accept writing to disk.</li>
        </ol>
      </li>
      <li>Format the partitions
        <ol>
          <li>Check to make sure your partitions look good. Run <code class="highlighter-rouge">lsblk</code> and verify all the partitions have the correct partition type.</li>
          <li>Format the UEFI System partition. Run <code class="highlighter-rouge">mkfs.fat -F32 /dev/sdX1</code>. This will format the partition with a FAT32 filesystem.</li>
          <li>Format the swap partition. Run <code class="highlighter-rouge">mkswap /dev/sdX2</code> and then <code class="highlighter-rouge">swapon /dev/sdX2</code>. This will create the swap filesystem and tell the system to use that as swap space.</li>
          <li>Format the root partition. Run <code class="highlighter-rouge">mkfs.ext4 /dev/sdX3</code>. This will create a linux filesystem on the last partition.</li>
        </ol>
      </li>
      <li>Mount the device
        <ol>
          <li>Mount the root partition. Run <code class="highlighter-rouge">mount /dev/sdX3 /mnt</code>.</li>
          <li>Create and mount the /boot partition. Run <code class="highlighter-rouge">mkdir -p /mnt/boot</code> and then <code class="highlighter-rouge">mount /dev/sdX1 /mnt/boot</code>.</li>
        </ol>
      </li>
      <li>
        <p>Install UEFI software</p>

        <ul>
          <li>There are multiple ways to do this. Some involve still using a bootloader, which I think is ridiculous. UEFI is meant to remove the need for bootloaders, so why use one? Run <code class="highlighter-rouge">efibootmgr -d /dev/sdX -p Y -c -L "Arch Linux" -l /vmlinuz-linux -u "root=/dev/sdX3 rw initrd=/initramfs-linux.img"</code>. Where X and Y are changed to reflect the disk and partition where the UEFI System partition is located. Change the root= parameter to reflect your Linux root (disk UUIDs can also be used). This will install the UEFI boot software directly to the /boot partition, and show it what to boot.</li>
        </ul>
      </li>
    </ol>
  </li>
  <li>Install Arch on your hard drive/s
    <ol>
      <li>Select your mirror
        <ol>
          <li><code class="highlighter-rouge">nano /etc/pacman.d/mirrorlist</code>.</li>
          <li>Once in the file, search for a mirror url that looks good to you.</li>
          <li>Put your cursor on the beginning of that url line, and hit Ctrl + k. This will cut that line.</li>
          <li>Navigate to the top of the file and hit Ctrl + u. This will paste that line to the top of the file and make it the mirror you will use to download your initial Arch packages.</li>
        </ol>
      </li>
      <li>Pacstrap
        <ul>
          <li><code class="highlighter-rouge">pacstrap -i /mnt base base-devel</code>. This will install the basic packages to your new system.</li>
        </ul>
      </li>
    </ol>
  </li>
  <li>Configure your install
    <ol>
      <li>Generate fstab
        <ul>
          <li><code class="highlighter-rouge">genfstab -U /mnt &gt;&gt; /mnt/etc/fstab</code></li>
        </ul>
      </li>
      <li>Change root into install
        <ul>
          <li><code class="highlighter-rouge">arch-chroot /mnt /bin/bash</code></li>
        </ul>
      </li>
      <li>Generate locales
        <ol>
          <li><code class="highlighter-rouge">nano /etc/locale.gen</code></li>
          <li>Uncomment your locale. Mine in the US is <code class="highlighter-rouge">en_US.UTF-8 UTF-8</code>.</li>
          <li>Type <code class="highlighter-rouge">locale-gen</code>. This will create the necessary system link.</li>
          <li>Type <code class="highlighter-rouge">echo LANG=en_US.UTF-8 &gt;&gt; /etc/locale.conf</code>. This creates a file that saves your locale.</li>
        </ol>
      </li>
      <li>Set time
        <ol>
          <li>Run <code class="highlighter-rouge">tz-select</code>.</li>
          <li>Create the symbolic link /etc/localtime, where Zone/Subzone is the TZ value from tzselect: <code class="highlighter-rouge">ln -s /usr/share/zoneinfo/Zone/SubZone /etc/localtime</code></li>
          <li>Set the hardware clock to UTC. <code class="highlighter-rouge">hwclock --systohc --utc</code>.</li>
        </ol>
      </li>
      <li>Configure the network
        <ul>
          <li>
            <p>There are two main ways to do this again: wired or wireless. I would reccommend doing both of these.</p>

            <ul>
              <li>
                <h5 id="wired-1">Wired</h5>
                <ul>
                  <li>Run<code class="highlighter-rouge">systemctl enable dhcpcd@interface.service</code>.</li>
                </ul>
              </li>
              <li>
                <h5 id="wireless-1">Wireless</h5>
                <ul>
                  <li>Install the needed packages for wifi-menu. <code class="highlighter-rouge">pacman -S iw wpa_supplicant dialog</code>.</li>
                </ul>
              </li>
            </ul>
          </li>
        </ul>
      </li>
      <li>Set root password
        <ul>
          <li><code class="highlighter-rouge">passwd</code></li>
        </ul>
      </li>
    </ol>
  </li>
  <li>Unmount and reboot
    <ol>
      <li><code class="highlighter-rouge">umount -R /mnt</code></li>
      <li><code class="highlighter-rouge">reboot</code></li>
    </ol>
  </li>
</ol>

            </div>
        </section>

        <footer class="post-footer">
            by Phillip Chaffee
        </footer>

    </article>
</main>
    <footer class="site-footer text-center">
    <p class="copyright"><a href="/" title="things">things</a> &copy; 2016 | <a href="https://github.com/PhillipChaffee/phillipchaffee.github.io">Source</a></p>
    <p class="poweredby">powered by <a href="https://jekyllrb.com/" title="Jekyll">Jekyll</a></p>
</footer>
</div>
</body>

</html>